# Alertmanager é…ç½®æ–‡ä»¶

global:
  # SMTP é…ç½®ï¼ˆç”¨äºé‚®ä»¶å‘Šè­¦ï¼‰
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alertmanager@kiki.dev'
  smtp_auth_username: 'alertmanager@kiki.dev'
  smtp_auth_password: 'password'

# è·¯ç”±é…ç½®
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'

  # å­è·¯ç”±
  routes:
    # API å‘Šè­¦
    - match:
        severity: critical
      receiver: 'api-critical'
      continue: true

    # ä¸šåŠ¡å‘Šè­¦
    - match:
        service: kiki-api
      receiver: 'kiki-team'

    # èµ„æºå‘Šè­¦
    - match_re:
        alertname: '^(HighMemoryUsage|HighCPUUsage|DiskSpaceLow)'
      receiver: 'infra-team'

# æ¥æ”¶å™¨é…ç½®
receivers:
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:5001/alerts'

  - name: 'api-critical'
    webhook_configs:
      - url: 'http://localhost:5001/critical-alerts'
    email_configs:
      - to: 'api-team@kiki.dev'
        headers:
          Subject: 'ğŸš¨ [CRITICAL] API Alert'

  - name: 'kiki-team'
    webhook_configs:
      - url: 'http://localhost:5001/kiki-alerts'

  - name: 'infra-team'
    webhook_configs:
      - url: 'http://localhost:5001/infra-alerts'

# æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å¦‚æœå†…å­˜ä½¿ç”¨ç‡è¿‡é«˜ï¼ŒæŠ‘åˆ¶ä½å†…å­˜å‘Šè­¦
  - source_match:
      alertname: 'HighMemoryUsage'
    target_match:
      alertname: 'LowMemory'
    equal: ['instance']

  # å¦‚æœæœåŠ¡å®•æœºï¼ŒæŠ‘åˆ¶è¯¥æœåŠ¡çš„æ‰€æœ‰å‘Šè­¦
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '.*'
    equal: ['service']
